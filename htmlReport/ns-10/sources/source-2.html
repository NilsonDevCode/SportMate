


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > menuAyuntamientoFragment</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.nilson.appsportmate.features.townhall.ui.menuTownhall</a>
</div>

<h1>Coverage Summary for Class: menuAyuntamientoFragment (com.nilson.appsportmate.features.townhall.ui.menuTownhall)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">menuAyuntamientoFragment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/65)
  </span>
</td>
</tr>
  <tr>
    <td class="name">menuAyuntamientoFragment$EventosResumenAdapter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">menuAyuntamientoFragment$EventosResumenAdapter$VH</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/52)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/108)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.nilson.appsportmate.features.townhall.ui.menuTownhall;
&nbsp;
&nbsp;import android.app.AlertDialog;
&nbsp;import android.net.Uri;
&nbsp;import android.os.Bundle;
&nbsp;import android.text.TextUtils;
&nbsp;import android.util.Log;
&nbsp;import android.view.LayoutInflater;
&nbsp;import android.view.View;
&nbsp;import android.view.ViewGroup;
&nbsp;import android.widget.Toast;
&nbsp;
&nbsp;import androidx.activity.result.ActivityResultLauncher;
&nbsp;import androidx.activity.result.contract.ActivityResultContracts;
&nbsp;import androidx.annotation.NonNull;
&nbsp;import androidx.annotation.Nullable;
&nbsp;import androidx.fragment.app.Fragment;
&nbsp;import androidx.lifecycle.ViewModelProvider;
&nbsp;import androidx.navigation.NavOptions;
&nbsp;import androidx.navigation.Navigation;
&nbsp;import androidx.recyclerview.widget.LinearLayoutManager;
&nbsp;import androidx.recyclerview.widget.RecyclerView;
&nbsp;
&nbsp;import com.bumptech.glide.Glide;
&nbsp;import com.google.firebase.auth.FirebaseAuth;
&nbsp;import com.google.firebase.firestore.CollectionReference;
&nbsp;import com.nilson.appsportmate.R;
&nbsp;import com.nilson.appsportmate.common.utils.Preferencias;
&nbsp;import com.nilson.appsportmate.databinding.FragmentMenuAyuntamientoBinding;
&nbsp;import com.google.android.material.button.MaterialButton;
&nbsp;import android.widget.TextView;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;
<b class="nc">&nbsp;public class menuAyuntamientoFragment extends Fragment {</b>
&nbsp;
&nbsp;    private FragmentMenuAyuntamientoBinding binding;
&nbsp;    private MenuAyuntamientoViewModel vm;
<b class="nc">&nbsp;    private final List&lt;Map&lt;String, Object&gt;&gt; listaEventos = new ArrayList&lt;&gt;();</b>
&nbsp;    private EventosResumenAdapter adapter;
&nbsp;
<b class="nc">&nbsp;    private final ActivityResultLauncher&lt;String&gt; pickImage =</b>
<b class="nc">&nbsp;            registerForActivityResult(new ActivityResultContracts.GetContent(), this::onImagePicked);</b>
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Nullable
&nbsp;    @Override
&nbsp;    public View onCreateView(@NonNull LayoutInflater inflater,
&nbsp;                             @Nullable ViewGroup container,
&nbsp;                             @Nullable Bundle savedInstanceState) {
<b class="nc">&nbsp;        binding = FragmentMenuAyuntamientoBinding.inflate(inflater, container, false);</b>
<b class="nc">&nbsp;        return binding.getRoot();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
<b class="nc">&nbsp;        super.onViewCreated(view, savedInstanceState);</b>
<b class="nc">&nbsp;        vm = new ViewModelProvider(this).get(MenuAyuntamientoViewModel.class);</b>
&nbsp;
<b class="nc">&nbsp;        binding.toolbar.setOnMenuItemClickListener(item -&gt; {</b>
<b class="nc">&nbsp;            int id = item.getItemId();</b>
&nbsp;
<b class="nc">&nbsp;            if (id == R.id.action_cambiar_foto_perfil) {</b>
<b class="nc">&nbsp;                pickImage.launch(&quot;image/*&quot;);</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;
<b class="nc">&nbsp;            } else if (id == R.id.action_gestion_eventos_mas_plazas) {</b>
<b class="nc">&nbsp;                Navigation.findNavController(binding.getRoot())</b>
<b class="nc">&nbsp;                        .navigate(R.id.action_global_gestionEventosMasPlazasFragment);</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;
<b class="nc">&nbsp;            } else if (id == R.id.action_cerrarSesion) {</b>
<b class="nc">&nbsp;                confirmarLogout();</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
<b class="nc">&nbsp;            return false;</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        binding.rvEventos.setLayoutManager(new LinearLayoutManager(requireContext()));</b>
<b class="nc">&nbsp;        adapter = new EventosResumenAdapter();</b>
<b class="nc">&nbsp;        binding.rvEventos.setAdapter(adapter);</b>
&nbsp;
<b class="nc">&nbsp;        binding.btnGestionDeportes.setOnClickListener(v -&gt;</b>
<b class="nc">&nbsp;                Navigation.findNavController(v)</b>
<b class="nc">&nbsp;                        .navigate(R.id.action_global_gestionDeportesAyuntamientoFragment)</b>
&nbsp;        );
&nbsp;
<b class="nc">&nbsp;        vm.getAyuntamientoNombre().observe(getViewLifecycleOwner(),</b>
<b class="nc">&nbsp;                nombre -&gt; binding.tvAytoNombre.setText(</b>
<b class="nc">&nbsp;                        TextUtils.isEmpty(nombre) ? &quot;Sin ayuntamiento asignado&quot; : nombre));</b>
&nbsp;
<b class="nc">&nbsp;        vm.getLogoUrl().observe(getViewLifecycleOwner(), url -&gt; {</b>
<b class="nc">&nbsp;            if (url != null &amp;&amp; !url.isEmpty() &amp;&amp; isAdded()) {</b>
<b class="nc">&nbsp;                Glide.with(requireContext())</b>
<b class="nc">&nbsp;                        .load(url)</b>
<b class="nc">&nbsp;                        .placeholder(R.drawable.ic_launcher_background)</b>
<b class="nc">&nbsp;                        .into(binding.imgLogo);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        vm.getEventos().observe(getViewLifecycleOwner(), evs -&gt; {</b>
<b class="nc">&nbsp;            listaEventos.clear();</b>
<b class="nc">&nbsp;            if (evs != null) listaEventos.addAll(evs);</b>
<b class="nc">&nbsp;            adapter.notifyDataSetChanged();</b>
<b class="nc">&nbsp;            binding.tvEmpty.setVisibility(listaEventos.isEmpty() ? View.VISIBLE : View.GONE);</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        vm.getMensaje().observe(getViewLifecycleOwner(),</b>
<b class="nc">&nbsp;                msg -&gt; { if (!TextUtils.isEmpty(msg)) Toast.makeText(requireContext(), msg, Toast.LENGTH_SHORT).show(); });</b>
&nbsp;
<b class="nc">&nbsp;        vm.cargarDatosAyuntamiento(requireContext());</b>
<b class="nc">&nbsp;        vm.cargarEventos(requireContext());</b>
&nbsp;    }
&nbsp;
&nbsp;    private void onImagePicked(@Nullable Uri uri) {
<b class="nc">&nbsp;        if (!isAdded() || uri == null) {</b>
<b class="nc">&nbsp;            Toast.makeText(requireContext(), &quot;No se seleccionó imagen.&quot;, Toast.LENGTH_SHORT).show();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Log.d(&quot;AYTO_DEBUG&quot;, &quot;Imagen seleccionada desde galería: &quot; + uri);</b>
<b class="nc">&nbsp;        binding.imgLogo.setImageURI(uri);</b>
<b class="nc">&nbsp;        vm.subirLogoAyuntamiento(uri, requireContext());</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void confirmarLogout() {
<b class="nc">&nbsp;        new AlertDialog.Builder(requireContext())</b>
<b class="nc">&nbsp;                .setTitle(&quot;Cerrar sesión&quot;)</b>
<b class="nc">&nbsp;                .setMessage(&quot;¿Seguro que quieres cerrar sesión?&quot;)</b>
<b class="nc">&nbsp;                .setPositiveButton(&quot;Sí, salir&quot;, (d, w) -&gt; {</b>
<b class="nc">&nbsp;                    FirebaseAuth.getInstance().signOut();</b>
<b class="nc">&nbsp;                    Preferencias.borrarTodo(requireContext());</b>
<b class="nc">&nbsp;                    NavOptions opts = new NavOptions.Builder()</b>
<b class="nc">&nbsp;                            .setPopUpTo(R.id.nav_graph, true)</b>
<b class="nc">&nbsp;                            .build();</b>
<b class="nc">&nbsp;                    Navigation.findNavController(binding.getRoot())</b>
<b class="nc">&nbsp;                            .navigate(R.id.authFragment, null, opts);</b>
&nbsp;                })
<b class="nc">&nbsp;                .setNegativeButton(&quot;Cancelar&quot;, null)</b>
<b class="nc">&nbsp;                .show();</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private class EventosResumenAdapter extends RecyclerView.Adapter&lt;EventosResumenAdapter.VH&gt; {</b>
&nbsp;
&nbsp;        class VH extends RecyclerView.ViewHolder {
&nbsp;            TextView tvTitulo, tvSub, tvPlazas, tvInscritos;
&nbsp;            MaterialButton btnMas, btnMenos, btnEditar, btnBorrar, btnInscritos;
&nbsp;            VH(@NonNull View itemView) {
<b class="nc">&nbsp;                super(itemView);</b>
<b class="nc">&nbsp;                tvTitulo = itemView.findViewById(R.id.tvTitulo);</b>
<b class="nc">&nbsp;                tvSub = itemView.findViewById(R.id.tvUbicacion);</b>
<b class="nc">&nbsp;                tvPlazas = itemView.findViewById(R.id.tvPlazas);</b>
<b class="nc">&nbsp;                tvInscritos = itemView.findViewById(R.id.tvInscritosCount);</b>
<b class="nc">&nbsp;                btnMas = itemView.findViewById(R.id.btnMas);</b>
<b class="nc">&nbsp;                btnMenos = itemView.findViewById(R.id.btnMenos);</b>
<b class="nc">&nbsp;                btnEditar = itemView.findViewById(R.id.btnEditar);</b>
<b class="nc">&nbsp;                btnBorrar = itemView.findViewById(R.id.btnBorrar);</b>
<b class="nc">&nbsp;                btnInscritos = itemView.findViewById(R.id.btnInscritos);</b>
<b class="nc">&nbsp;                if (btnMas != null) btnMas.setVisibility(View.GONE);</b>
<b class="nc">&nbsp;                if (btnMenos != null) btnMenos.setVisibility(View.GONE);</b>
<b class="nc">&nbsp;                if (btnEditar != null) btnEditar.setVisibility(View.GONE);</b>
<b class="nc">&nbsp;                if (btnBorrar != null) btnBorrar.setVisibility(View.GONE);</b>
<b class="nc">&nbsp;                if (btnInscritos != null) btnInscritos.setVisibility(View.GONE);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @NonNull
&nbsp;        @Override
&nbsp;        public VH onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
<b class="nc">&nbsp;            View v = LayoutInflater.from(parent.getContext())</b>
<b class="nc">&nbsp;                    .inflate(R.layout.item_evento_gestion, parent, false);</b>
<b class="nc">&nbsp;            return new VH(v);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onBindViewHolder(@NonNull VH h, int position) {
<b class="nc">&nbsp;            Map&lt;String, Object&gt; ev = listaEventos.get(position);</b>
<b class="nc">&nbsp;            String idDoc = String.valueOf(ev.get(&quot;idDoc&quot;));</b>
<b class="nc">&nbsp;            String nombre = safe(ev.get(&quot;nombre&quot;));</b>
<b class="nc">&nbsp;            String fecha = safe(ev.get(&quot;fecha&quot;));</b>
<b class="nc">&nbsp;            String hora = safe(ev.get(&quot;hora&quot;));</b>
<b class="nc">&nbsp;            long plazas = toLong(ev.get(&quot;plazasDisponibles&quot;));</b>
&nbsp;
<b class="nc">&nbsp;            h.tvTitulo.setText(nombre.isEmpty() ? &quot;-&quot; : nombre);</b>
<b class="nc">&nbsp;            String sub = fecha;</b>
<b class="nc">&nbsp;            if (!hora.isEmpty()) sub = sub.isEmpty() ? hora : (sub + &quot; &quot; + hora);</b>
<b class="nc">&nbsp;            h.tvSub.setText(sub.isEmpty() ? &quot;-&quot; : sub);</b>
<b class="nc">&nbsp;            h.tvPlazas.setText(&quot;Plazas disponibles: &quot; + plazas);</b>
<b class="nc">&nbsp;            h.tvInscritos.setText(&quot;Inscritos: —&quot;);</b>
&nbsp;
<b class="nc">&nbsp;            CollectionReference ref = vm.getInscritosRef(idDoc);</b>
<b class="nc">&nbsp;            if (ref != null) {</b>
<b class="nc">&nbsp;                ref.get()</b>
<b class="nc">&nbsp;                        .addOnSuccessListener(snap -&gt; h.tvInscritos.setText(&quot;Inscritos: &quot; + snap.size()))</b>
<b class="nc">&nbsp;                        .addOnFailureListener(e -&gt; h.tvInscritos.setText(&quot;Inscritos: —&quot;));</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
<b class="nc">&nbsp;        public int getItemCount() { return listaEventos.size(); }</b>
&nbsp;
<b class="nc">&nbsp;        private String safe(Object o) { return o == null ? &quot;&quot; : String.valueOf(o).trim(); }</b>
&nbsp;
&nbsp;        private long toLong(Object o) {
<b class="nc">&nbsp;            if (o instanceof Long) return (Long) o;</b>
<b class="nc">&nbsp;            if (o instanceof Integer) return ((Integer) o).longValue();</b>
<b class="nc">&nbsp;            if (o instanceof String) {</b>
<b class="nc">&nbsp;                try { return Long.parseLong((String) o); } catch (Exception ignored) {}</b>
&nbsp;            }
<b class="nc">&nbsp;            return 0L;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void onDestroyView() {
<b class="nc">&nbsp;        super.onDestroyView();</b>
<b class="nc">&nbsp;        binding = null;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-11-11 18:12</div>
</div>
</body>
</html>
